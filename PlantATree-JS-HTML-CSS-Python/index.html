<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>PlantATree - Еко инициативи София | Засади дърво, опази природата</title>
    <meta name="description" content="Присъединете се към най-голямата еко платформа в София! Засаждайте дървета, следете качеството на въздуха, участвайте в еко инициативи и печелете награди.">
    <meta name="keywords" content="еко инициативи, засаждане дървета, София, околна среда, качество въздух, зелени зони, екология, PlantATree">
    <meta name="author" content="PlantATree Team">
    <meta name="robots" content="index, follow">

    <meta property="og:title" content="PlantATree - Еко инициативи София">
    <meta property="og:description" content="Присъединете се към най-голямата еко платформа в София! Засаждайте дървета и участвайте в еко инициативи.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://plantatree-sofia.com/">
    <meta property="og:image" content="https://plantatree-sofia.com/images/og-image.jpg">

    <link rel="canonical" href="https://plantatree-sofia.com/">
    
    <link rel="stylesheet" href="design.css">
    <link rel="stylesheet" href="static/css/auth.css">
    <link rel="stylesheet" href="static/css/chat.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/@geoapify/leaflet-address-search-plugin@^1/dist/L.Control.GeoapifyAddressSearch.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://unpkg.com/@geoapify/leaflet-address-search-plugin@^1/dist/L.Control.GeoapifyAddressSearch.min.js"></script>
</head>
<body>
    
    <nav class="navbar">
        <div class="nav-container" style="display:flex;align-items:center;justify-content:space-between;width:100%;">
            <div class="logo" style="flex:0 0 auto;">
                <i class="fas fa-tree"></i>
                <span>EcoBuilders</span>
            </div>
            <ul class="nav-menu" style="flex:1 1 0;justify-content:center;display:flex;gap:1.5rem;align-items:center;margin:0;">
                <li><a href="#" onclick="showSection('home')" class="nav-link">Home</a></li>
                <li><a href="#" onclick="showSection('map')" class="nav-link">Map</a></li>
                <li><a href="#" onclick="showSection('feed')" class="nav-link">Eco Actions</a></li>
                <li><a href="#" onclick="showSection('air-quality')" class="nav-link">Air Quality</a></li>
                <li><a href="#" onclick="showSection('leaderboard')" class="nav-link">Leaderboard</a></li>
                <li><a href="#" onclick="showSection('sponsors')" class="nav-link">Sponsors</a></li>
            </ul>
            <div class="nav-right" style="flex:0 0 auto;display:flex;align-items:center;gap:1.2rem;">
                <a href="#" onclick="showSection('profile')" class="nav-link" style="font-weight:600;">Profile</a>
                <div class="auth-buttons">
                    <button class="btn-login" onclick="showModal('loginModal')">Sign In</button>
                    <button class="btn-register" onclick="showModal('registerModal')">Register</button>
                </div>
            </div>
        </div>
    </nav>

    <section id="home" class="hero">
        <div class="hero-video-container">
            <video autoplay muted loop class="hero-video" id="hero-video" preload="metadata">
                <source src="video1.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            
            <div class="fallback-slideshow" id="fallback-slideshow">
                <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')"></div>
                <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')"></div>
                <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1511593358241-7eea1f3c84e5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')"></div>
                <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')"></div>
            </div>
        </div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Help Make Sofia Greener</h1>
            <p>Platform for mapping green zones, eco trails, and sharing eco initiatives in Bulgaria</p>
            <div class="hero-buttons">
                <button class="btn-primary" onclick="showSection('map')">
                    <i class="fas fa-map-marked-alt"></i> View Map
                </button>
                <button class="btn-primary" onclick="showSection('feed')">
                    <i class="fas fa-leaf"></i> Eco Actions
                </button>
            </div>
        </div>
        <div class="hero-stats">
            <div class="stat">
                <div class="stat-number" data-target="150">0+</div>
                <div class="stat-label">Green Zones</div>
            </div>
            <div class="stat">
                <div class="stat-number" data-target="500">0+</div>
                <div class="stat-label">Planted Trees</div>
            </div>
            <div class="stat">
                <div class="stat-number" data-target="200">0+</div>
                <div class="stat-label">Active Users</div>
            </div>
        </div>
    </section>

    <section id="map" class="section hidden">
        <div class="section-header">
            <h2><i class="fas fa-map-marked-alt"></i> Map of Green Zones</h2>
            <p>Discover parks, eco trails, and bike lanes in Sofia</p>
        </div>

        <div class="sofia-tools-panel">
            <h3><i class="fas fa-hammer"></i> Sofia Redesign Tools</h3>
            <div class="save-notice">
                <i class="fas fa-database"></i>
                <span data-translate="auto_save_notice">Changes are saved automatically to the database</span>
            </div>
            <div class="redesign-tools">
                <button class="redesign-tool active" id="select-tool" onclick="setRedesignTool('select')">
                    <i class="fas fa-mouse-pointer"></i>
                    <span data-translate="tool_selection">Select</span>
                </button>
                <button class="redesign-tool" id="park-tool" onclick="setRedesignTool('park')">
                    <i class="fas fa-tree"></i>
                    <span data-translate="tool_park">Park</span>
                </button>
                <button class="redesign-tool" id="alley-tool" onclick="setRedesignTool('alley')">
                    <i class="fas fa-road"></i>
                    <span data-translate="tool_alley">Alley/Street</span>
                </button>
                <button class="redesign-tool" id="green-zone-tool" onclick="setRedesignTool('greenzone')">
                    <i class="fas fa-leaf"></i>
                    <span data-translate="tool_green_zone">Зелена зона</span>
                </button>
                <button class="redesign-tool" id="bike-lane-tool" onclick="setRedesignTool('bikelane')">
                    <i class="fas fa-bicycle"></i>
                    <span data-translate="tool_bike_lane">Велоалея</span>
                </button>
                <div class="zone-dropdown-container">
                    <button class="redesign-tool dropdown-toggle" id="zone-tool" onclick="toggleZoneDropdown()">
                        <i class="fas fa-city"></i>
                        <span data-translate="tool_zones">Зони</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </button>
                    <div class="zone-dropdown" id="zone-dropdown">
                        <button class="zone-option" onclick="setRedesignTool('residential')">
                            <i class="fas fa-home"></i>
                            <span data-translate="zone_residential">Жилищна зона</span>
                        </button>
                        <button class="zone-option" onclick="setRedesignTool('commercial')">
                            <i class="fas fa-store"></i>
                            <span data-translate="zone_commercial">Търговска зона</span>
                        </button>
                        <button class="zone-option" onclick="setRedesignTool('industrial')">
                            <i class="fas fa-industry"></i>
                            <span data-translate="zone_industrial">Индустриална зона</span>
                        </button>
                        <button class="zone-option" onclick="setRedesignTool('office')">
                            <i class="fas fa-building"></i>
                            <span data-translate="zone_office">Офис зона</span>
                        </button>
                        <button class="zone-option" onclick="setRedesignTool('mixed')">
                            <i class="fas fa-puzzle-piece"></i>
                            <span data-translate="zone_mixed">Смесена зона</span>
                        </button>
                        <button class="zone-option" onclick="setRedesignTool('public')">
                            <i class="fas fa-landmark"></i>
                            <span data-translate="zone_public">Обществена зона</span>
                        </button>
                    </div>
                </div>
                <button class="redesign-tool" id="boundary-tool" onclick="setRedesignTool('boundary')">
                    <i class="fas fa-circle"></i>
                    <span data-translate="tool_boundaries">Граници</span>
                </button>
                <button class="redesign-tool" id="clear-tool" onclick="clearAllRedesigns()">
                    <i class="fas fa-eraser"></i>
                    <span data-translate="tool_clear">Изчисти всичко</span>
                </button>
            </div>
            <div class="save-controls">
                <button class="save-btn" onclick="saveDrawnItems()" title="Запази текущите промени">
                    <i class="fas fa-save"></i>
                    <span data-translate="btn_save">Запази</span>
                </button>
                <button class="load-btn" onclick="loadDrawnItems()" title="Зареди запазените промени">
                    <i class="fas fa-download"></i>
                    <span data-translate="btn_load">Зареди</span>
                </button>
                <button class="clear-saved-btn" onclick="clearSavedItems()" title="Изтрий запазените данни">
                    <i class="fas fa-trash"></i>
                    <span data-translate="btn_delete_saved">Изтрий запазеното</span>
                </button>
            </div>
            <div class="current-tool-info">
                <span id="current-redesign-tool" data-translate="current_tool_info">Избран инструмент: Селектиране област</span>
                <small data-translate="tool_selection_desc">Кликнете и влачете върху картата за да селектирате област за преустройство. Промените са временни.</small>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map-canvas" class="map-canvas">
                <div class="map-placeholder" id="map-placeholder">
                    <i class="fas fa-map"></i>
                    <p data-translate="map_placeholder_text">Кликнете "Покажи карта" за да заредите интерактивната карта</p>
                    <button onclick="loadMapWithRedesign()" style="background: #7bc142; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                        <span data-translate="btn_show_map">Покажи карта на София</span>
                    </button>
                </div>
            </div>
            <div class="map-sidebar">
                
                <div class="sofia-sidebar-stats">
                    <h3><i class="fas fa-city"></i> София</h3>
                    <div class="sidebar-stats-grid">
                        <div class="sidebar-stat-item">
                            <i class="fas fa-tree stat-icon"></i>
                            <div class="stat-info">
                                <span class="stat-label">Зеленина</span>
                                <span class="stat-value" id="sidebar-green-percent">30%</span>
                            </div>
                        </div>
                        <div class="sidebar-stat-item">
                            <i class="fas fa-leaf stat-icon"></i>
                            <div class="stat-info">
                                <span class="stat-label">Паркове</span>
                                <span class="stat-value" id="sidebar-parks-count">126</span>
                            </div>
                        </div>
                        <div class="sidebar-stat-item">
                            <i class="fas fa-users stat-icon"></i>
                            <div class="stat-info">
                                <span class="stat-label">Население</span>
                                <span class="stat-value" id="sidebar-population">1.4М</span>
                            </div>
                        </div>
                        <div class="sidebar-stat-item">
                            <i class="fas fa-expand-arrows-alt stat-icon"></i>
                            <div class="stat-info">
                                <span class="stat-label">Площ</span>
                                <span class="stat-value" id="sidebar-area">492 км²</span>
                            </div>
                        </div>
                        <div class="sidebar-stat-item">
                            <i class="fas fa-seedling stat-icon"></i>
                            <div class="stat-info">
                                <span class="stat-label">Зелени зони</span>
                                <span class="stat-value" id="sidebar-green-area">147.6 км²</span>
                            </div>
                        </div>
                        <div class="sidebar-stat-item">
                            <i class="fas fa-wind stat-icon"></i>
                            <div class="stat-info">
                                <span class="stat-label">Качество въздух</span>
                                <span class="stat-value" id="sidebar-air-quality">72</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sofia-facts-panel" id="sofia-facts-panel" style="display: none;">
            <h3><i class="fas fa-lightbulb"></i> <span data-translate="facts_title">Знаете ли, че...</span></h3>
            <div class="fact-container">
                <div class="fact-item" id="current-fact">
                    <p data-translate="map_loading_text">Зареждане на интересни факти за София...</p>
                </div>
                <button class="fact-btn" onclick="showRandomFact()">
                    <i class="fas fa-refresh"></i> <span data-translate="new_fact_btn">нов факт</span>
                </button>
            </div>
        </div>
    </section>

        <div class="builder-container" style="display: none;">
            
            <div class="city-stats-panel">
                <h3><i class="fas fa-chart-line"></i> Статистики на града</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="population">5000</span>
                            <span class="stat-label">Население</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-leaf"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="green-coverage">35%</span>
                            <span class="stat-label">Зелено покритие</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💰</div>
                        <div class="stat-info">
                            <span class="stat-value" id="budget">25000</span>
                            <span class="stat-label">Бюджет</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">😊</div>
                        <div class="stat-info">
                            <span class="stat-value" id="happiness">80</span>
                            <span class="stat-label">Щастие %</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="building-tools-panel">
                <h3><i class="fas fa-tools"></i> Инструменти за строене</h3>
                <div class="tool-categories">
                    <div class="tool-category">
                        <h4><i class="fas fa-tree"></i> Зелени зони</h4>
                        <div class="tools-grid">
                            <button class="tool-btn" onclick="selectTool('park')" data-tool="park">
                                <i class="fas fa-tree"></i>
                                <span>Парк</span>
                                <small>Цена: 500</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('forest')" data-tool="forest">
                                <i class="fas fa-seedling"></i>
                                <span>Гора</span>
                                <small>Цена: 800</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('garden')" data-tool="garden">
                                <i class="fas fa-leaf"></i>
                                <span>Градина</span>
                                <small>Цена: 300</small>
                            </button>
                        </div>
                    </div>
                    
                    <div class="tool-category">
                        <h4>🏢 Сгради</h4>
                        <div class="tools-grid">
                            <button class="tool-btn" onclick="selectTool('residential')" data-tool="residential">
                                <i class="fas fa-home"></i>
                                <span>Жилищна</span>
                                <small>Цена: 1200</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('commercial')" data-tool="commercial">
                                <i class="fas fa-store"></i>
                                <span>Търговска</span>
                                <small>Цена: 1500</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('industrial')" data-tool="industrial">
                                <i class="fas fa-industry"></i>
                                <span>Индустриална</span>
                                <small>Цена: 2000</small>
                            </button>
                        </div>
                    </div>
                    
                    <div class="tool-category">
                        <h4>🚗 Инфраструктура</h4>
                        <div class="tools-grid">
                            <button class="tool-btn" onclick="selectTool('road')" data-tool="road">
                                <i class="fas fa-road"></i>
                                <span>Път</span>
                                <small>Цена: 100</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('bike-path')" data-tool="bike-path">
                                <i class="fas fa-bicycle"></i>
                                <span>Велоалея</span>
                                <small>Цена: 200</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('solar')" data-tool="solar">
                                <i class="fas fa-solar-panel"></i>
                                <span>Соларни панели</span>
                                <small>Цена: 1000</small>
                            </button>
                        </div>
                    </div>
                    
                    <div class="tool-category">
                        <h4><i class="fas fa-tools"></i> Utilities</h4>
                        <div class="tools-grid">
                            <button class="tool-btn" onclick="selectTool('demolish')" data-tool="demolish">
                                <i class="fas fa-trash"></i>
                                <span>Съборяване</span>
                                <small>Безплатно</small>
                            </button>
                            <button class="tool-btn" onclick="selectTool('info')" data-tool="info">
                                <i class="fas fa-info-circle"></i>
                                <span>Информация</span>
                                <small>Безплатно</small>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="city-grid-container">
                <h3><i class="fas fa-th"></i> Планировка на града</h3>
                <div class="selected-tool-info" id="selected-tool-info">
                    <span>Избран инструмент: <strong id="current-tool">Няма</strong></span>
                </div>
                <div class="city-grid" id="city-grid">
                    
                </div>
            </div>
        </div>
    </section>

    <section id="feed" class="section hidden">
        
        <div class="eco-actions-header">
            <h1>Еко действия</h1>
            <p class="eco-actions-subtitle">Споделете вашите еко инициативи с общността и вдъхновете други да следват вашия пример</p>

            <div class="charity-card">
                <div class="charity-content">
                    <div class="charity-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="charity-text">
                        <h3>Благотворителност</h3>
                        <p>За всеки 500 събрани точки от общността дарявame 1 лв. за залесяване и опазване на природата!</p>
                        <div class="charity-progress">
                            <div class="progress-info">
                                <span class="progress-text"><span id="charity-total-points">0</span>/500 точки до следващото дарение</span>
                                <span class="progress-percentage" id="charity-percentage">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="charity-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="eco-add-action-btn" onclick="handleAddActionClick()">
                <i class="fas fa-plus"></i> 
                <span>Добави действие</span>
            </button>
        </div>

        <div class="eco-actions-container">
            <div class="eco-actions-grid" id="ecoActionsGrid">
                
                <div class="eco-action-card">
                    <div class="eco-card-header">
                        <div class="eco-user-info">
                            <img src="https://via.placeholder.com/50x50/7bc142/white?text=М" alt="user" class="eco-user-avatar">
                            <div class="eco-user-details">
                                <h4 class="eco-username">Мария Петрова</h4>
                                <span class="eco-post-date">преди 2 часа</span>
                            </div>
                        </div>
                        <div class="eco-points-badge">+10 точки</div>
                    </div>
                    
                    <div class="eco-card-content">
                        <img src="https://images.unsplash.com/photo-1574263867128-ce9ac6b4d8e5?w=400&h=200&fit=crop" alt="eco action" class="eco-action-image">
                        <div class="eco-card-body">
                            <h3 class="eco-action-title">Засадих 3 дървета в Борисовата градина</h3>
                            <p class="eco-action-description">Участвах в еко акция за засаждане на дървета. Всеки може да помогне за по-зелена София!</p>
                            <div class="eco-action-location">
                                <i class="fas fa-map-marker-alt"></i> 
                                <span>Борисова градина, София</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="eco-card-actions">
                        <button class="eco-action-btn eco-like-btn">
                            <i class="fas fa-heart"></i> 
                            <span>15</span>
                        </button>
                        <button class="eco-action-btn eco-comment-btn">
                            <i class="fas fa-comment"></i> 
                            <span>3</span>
                        </button>
                        <button class="eco-action-btn eco-share-btn">
                            <i class="fas fa-share"></i> 
                            <span>Сподели</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="leaderboard" class="section hidden">
        <div class="section-header">
            <h2><i class="fas fa-trophy"></i> Класация</h2>
            <p>Топ еко герои на София</p>
        </div>

        <div class="leaderboard-stats">
            <div class="stat-card total-users">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-info">
                    <span class="stat-number" id="total-users">127</span>
                    <span class="stat-label">Активни потребители</span>
                </div>
            </div>
            <div class="stat-card total-actions">
                <div class="stat-icon"><i class="fas fa-leaf"></i></div>
                <div class="stat-info">
                    <span class="stat-number" id="total-actions">2,543</span>
                    <span class="stat-label">Общо действия</span>
                </div>
            </div>
            <div class="stat-card total-points">
                <div class="stat-icon"><i class="fas fa-star"></i></div>
                <div class="stat-info">
                    <span class="stat-number" id="total-points">18,720</span>
                    <span class="stat-label">Общо точки</span>
                </div>
            </div>
        </div>

        <div class="leaderboard-filters">
            <button class="filter-btn active" onclick="filterLeaderboard('all')">Всички</button>
            <div class="filter-dropdown">
                <button class="filter-btn dropdown-toggle" onclick="toggleTimeFilter()">
                    <span id="current-filter">Този месец</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-menu hidden" id="time-filter-menu">
                    <button onclick="filterLeaderboard('week')">Тази седмица</button>
                    <button onclick="filterLeaderboard('month')">Този месец</button>
                    <button onclick="filterLeaderboard('year')">Тази година</button>
                    <button onclick="filterLeaderboard('all')">Всички времена</button>
                </div>
            </div>
            <button class="filter-btn" onclick="filterLeaderboard('trees')">Дървета</button>
            <button class="filter-btn" onclick="filterLeaderboard('cleanup')">Почистване</button>
            <button class="filter-btn" onclick="filterLeaderboard('bike')">Велосипед</button>
        </div>

        <div class="leaderboard-container">
            <div class="leaderboard-table">
                <div class="table-header">
                    <div class="rank-header" data-translate="position_header">Позиция</div>
                    <div class="user-header" data-translate="user_header">Потребител</div>
                    <div class="points-header" data-translate="points_header">Точки</div>
                    <div class="actions-header" data-translate="actions_header">Действия</div>
                    <div class="badges-header" data-translate="badges_header">Баджове</div>
                </div>

                <div class="podium-section">
                    <div class="podium-item gold" id="user-1">
                        <div class="podium-rank">
                            <i class="fas fa-crown"></i>
                            <span>1</span>
                        </div>
                        <div class="podium-avatar">
                            <img src="https://via.placeholder.com/80x80/FFD700/white?text=М" alt="Мария">
                            <div class="online-indicator"></div>
                        </div>
                        <div class="podium-info">
                            <h4>Мария Петрова</h4>
                            <div class="podium-stats">
                                <span class="points">1,250 точки</span>
                                <span class="actions">85 действия</span>
                            </div>
                            <div class="podium-badges">
                                <span class="badge eco-hero" data-translate="eco_hero_badge">Еко герой</span>
                                <span class="badge tree-master" data-translate="tree_master_badge">Майстор дървета</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="podium-item silver" id="user-2">
                        <div class="podium-rank">
                            <i class="fas fa-medal"></i>
                            <span>2</span>
                        </div>
                        <div class="podium-avatar">
                            <img src="https://via.placeholder.com/80x80/C0C0C0/white?text=П" alt="Петър">
                        </div>
                        <div class="podium-info">
                            <h4>Петър Иванов</h4>
                            <div class="podium-stats">
                                <span class="points">1,120 точки</span>
                                <span class="actions">72 действия</span>
                            </div>
                            <div class="podium-badges">
                                <span class="badge bike-rider" data-translate="cyclist_badge">Велосипедист</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="podium-item bronze" id="user-3">
                        <div class="podium-rank">
                            <i class="fas fa-award"></i>
                            <span>3</span>
                        </div>
                        <div class="podium-avatar">
                            <img src="https://via.placeholder.com/80x80/CD7F32/white?text=А" alt="Анна">
                        </div>
                        <div class="podium-info">
                            <h4>Анна Георгиева</h4>
                            <div class="podium-stats">
                                <span class="points">950 точки</span>
                                <span class="actions">63 действия</span>
                            </div>
                            <div class="podium-badges">
                                <span class="badge cleaner" data-translate="cleaner_badge">Почистител</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="regular-rankings" id="leaderboard-list">
                    
                </div>
            </div>

            <div class="your-position">
                <h3><i class="fas fa-user"></i> Твоята позиция</h3>
                <div class="position-card">
                    <div class="position-rank">#12</div>
                    <div class="position-avatar">
                        <img src="https://via.placeholder.com/60x60/7bc142/white?text=И" alt="Иван">
                    </div>
                    <div class="position-info">
                        <h4>Иван Петров</h4>
                        <div class="position-stats">
                            <span class="points">420 точки</span>
                            <span class="actions">28 действия</span>
                        </div>
                        <div class="position-progress">
                            <span>До следваща позиция: 45 точки</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="air-quality" class="section hidden">
        <div class="section-header">
            <h2><i class="fas fa-wind"></i> Качество на въздуха</h2>
            <p>Данни в реално време за въздушното качество в София</p>
        </div>
        
        <div class="air-quality-container">
            
            <div class="air-quality-card main-card">
                <div class="card-header">
                    <h3><i class="fas fa-map-marker-alt"></i> <span data-translate="sofia_center">София Център</span></h3>
                    <div class="last-updated" id="last-updated"><span data-translate="last_updated">Последно обновяване</span>: зареждане...</div>
                </div>
                
                <div class="aqi-display">
                    <div class="aqi-value" id="aqi-value">--</div>
                    <div class="aqi-label" data-translate="aqi_label">AQI</div>
                    <div class="aqi-status" id="aqi-status" data-translate="loading">Зареждане...</div>
                </div>
                
                <div class="pollutants-grid">
                    <div class="pollutant-item">
                        <div class="pollutant-icon"><i class="fas fa-smog"></i></div>
                        <div class="pollutant-info">
                            <span class="pollutant-value" id="pm25-value">--</span>
                            <span class="pollutant-label">PM2.5</span>
                        </div>
                    </div>
                    <div class="pollutant-item">
                        <div class="pollutant-icon"><i class="fas fa-cloud"></i></div>
                        <div class="pollutant-info">
                            <span class="pollutant-value" id="pm10-value">--</span>
                            <span class="pollutant-label">PM10</span>
                        </div>
                    </div>
                    <div class="pollutant-item">
                        <div class="pollutant-icon"><i class="fas fa-flask"></i></div>
                        <div class="pollutant-info">
                            <span class="pollutant-value" id="no2-value">--</span>
                            <span class="pollutant-label">NO₂</span>
                        </div>
                    </div>
                    <div class="pollutant-item">
                        <div class="pollutant-icon"><i class="fas fa-industry"></i></div>
                        <div class="pollutant-info">
                            <span class="pollutant-value" id="o3-value">--</span>
                            <span class="pollutant-label">O₃</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="weather-card">
                <h3><i class="fas fa-cloud-sun"></i> <span data-translate="weather_conditions">Метеорологични условия</span></h3>
                <div class="weather-info">
                    <div class="weather-item">
                        <i class="fas fa-thermometer-half"></i>
                        <span><span data-translate="temperature_label">Температура</span>: <span id="temperature">--°C</span></span>
                    </div>
                    <div class="weather-item">
                        <i class="fas fa-tint"></i>
                        <span><span data-translate="humidity_label">Влажност</span>: <span id="humidity">--%</span></span>
                    </div>
                    <div class="weather-item">
                        <i class="fas fa-wind"></i>
                        <span><span data-translate="wind_label">Вятър</span>: <span id="wind-speed">-- км/ч</span></span>
                    </div>
                    <div class="weather-item">
                        <i class="fas fa-eye"></i>
                        <span><span data-translate="visibility_label">Видимост</span>: <span id="visibility">-- км</span></span>
                    </div>
                </div>
            </div>

            <div class="health-recommendations">
                <h3><i class="fas fa-heart"></i> <span data-translate="health_rec_title">Препоръки за здравето</span></h3>
                <div class="recommendation-content" id="health-recommendations">
                    <p data-translate="loading">Зареждане на препоръки...</p>
                </div>
            </div>

            <div class="chart-container">
                <h3><i class="fas fa-chart-line"></i> <span data-translate="aqi_trend_title">24-часова тенденция</span></h3>
                <div class="chart-placeholder" id="air-quality-chart">
                    <p data-translate="loading">Зареждане на графика...</p>
                </div>
            </div>

            <div class="location-selector">
                <h3><i class="fas fa-location-arrow"></i> <span data-translate="location_selector_title">Избери локация</span></h3>
                <select id="location-select" onchange="changeLocation()">
                    <option value="sofia-center">София Център</option>
                    <option value="sofia-lozenets">София Лозенец</option>
                    <option value="sofia-studentski-grad">София Студентски град</option>
                    <option value="sofia-druzhba">София Дружба</option>
                    <option value="sofia-lyulin">София Люлин</option>
                </select>
                <button class="btn-secondary" onclick="getCurrentLocationAir()">
                    <i class="fas fa-crosshairs"></i> <span data-translate="btn_my_location">Моята локация</span>
                </button>
            </div>
        </div>
    </section>

    <section id="profile" class="section hidden">
        <div class="section-header">
            <h2><i class="fas fa-user"></i> Потребителски профил</h2>
        </div>
        <div class="profile-container">
            <div class="profile-card">
                <img id="profile-avatar" src="https://via.placeholder.com/100x100/7bc142/white?text=U" alt="profile" class="profile-avatar">
                <h3 id="profile-name">Зареждане...</h3>
                <div class="profile-stats">
                    <div class="profile-stat">
                        <span id="profile-points" class="stat-number">-</span>
                        <span class="stat-label">Точки</span>
                    </div>
                    <div class="profile-stat">
                        <span id="profile-actions" class="stat-number">-</span>
                        <span class="stat-label">Действия</span>
                    </div>
                    <div class="profile-stat">
                        <span id="profile-badges" class="stat-number">-</span>
                        <span class="stat-label">Баджове</span>
                    </div>
                </div>
                <div id="profile-badges-list" class="user-badges">
                    
                </div>
            </div>
            <div class="profile-history">
                <h4>История на действията</h4>
                <div id="profile-history-list">
                    
                </div>
            </div>
        </div>
    </section>

    <section id="sponsors" class="section hidden">
        <div class="container">
            <div class="sponsors-header">
                <h1>Нашите спонсори</h1>
                <p class="sponsors-subtitle">Компании, които подкрепят зелената мисия на София</p>
            </div>

            <div class="sponsors-tier main-tier">
                <h2 class="tier-title">
                    <i class="fas fa-crown"></i>
                    Златни партньори
                </h2>
                <div class="sponsors-grid gold-tier">
                    <div class="sponsor-card featured">
                        <div class="sponsor-logo">
                            <i class="fas fa-leaf" style="font-size: 3rem; color: #2e7d32;"></i>
                        </div>
                        <h3>EcoVision България</h3>
                        <p class="sponsor-type" data-translate="eco_technologies">Еко технологии</p>
                        <p class="sponsor-description">Водеща компания в областта на възобновяемата енергия и устойчивото развитие в България.</p>
                        <div class="sponsor-contribution">
                            <div class="contribution-item">
                                <i class="fas fa-tree"></i>
                                <span>1,500 <span data-translate="trees_planted">дървета засадени</span></span>
                            </div>
                            <div class="contribution-item">
                                <i class="fas fa-euro-sign"></i>
                                <span>50,000 <span data-translate="investment_amount">лв. инвестиция</span></span>
                            </div>
                        </div>
                        <div class="sponsor-badges">
                            <span class="badge premium" data-translate="premium_partner">Премиум партньор</span>
                            <span class="badge verified" data-translate="verified_badge">Верифициран</span>
                        </div>
                    </div>

                    <div class="sponsor-card featured">
                        <div class="sponsor-logo">
                            <i class="fas fa-solar-panel" style="font-size: 3rem; color: #ff9800;"></i>
                        </div>
                        <h3>GreenTech Solutions</h3>
                        <p class="sponsor-type" data-translate="solar_solutions">Соларни решения</p>
                        <p class="sponsor-description">Иновативни решения за чиста енергия и интелигентни градове на бъдещето.</p>
                        <div class="sponsor-contribution">
                            <div class="contribution-item">
                                <i class="fas fa-bolt"></i>
                                <span>200 соларни панела</span>
                            </div>
                            <div class="contribution-item">
                                <i class="fas fa-chart-line"></i>
                                <span>30% по-чист въздух</span>
                            </div>
                        </div>
                        <div class="sponsor-badges">
                            <span class="badge premium" data-translate="premium_partner">Премиум партньор</span>
                            <span class="badge innovation" data-translate="innovation_badge">Иновация</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sponsors-tier silver-tier">
                <h2 class="tier-title">
                    <i class="fas fa-medal"></i>
                    Сребърни партньори
                </h2>
                <div class="sponsors-grid">
                    <div class="sponsor-card">
                        <div class="sponsor-logo">
                            <i class="fas fa-recycle" style="font-size: 2.5rem; color: #4caf50;"></i>
                        </div>
                        <h3>БулРециклинг</h3>
                        <p class="sponsor-type">Рециклиране</p>
                        <p class="sponsor-description">Специализирани услуги за рециклиране и управление на отпадъци.</p>
                        <div class="sponsor-contribution">
                            <div class="contribution-item">
                                <i class="fas fa-trash"></i>
                                <span>500 тона рециклирани</span>
                            </div>
                        </div>
                        <div class="sponsor-badges">
                            <span class="badge standard">Стандартен партньор</span>
                        </div>
                    </div>

                    <div class="sponsor-card">
                        <div class="sponsor-logo">
                            <i class="fas fa-bicycle" style="font-size: 2.5rem; color: #2196f3;"></i>
                        </div>
                        <h3>Sofia Bike Share</h3>
                        <p class="sponsor-type">Градска мобилност</p>
                        <p class="sponsor-description">Система за споделяне на велосипеди за устойчив градски транспорт.</p>
                        <div class="sponsor-contribution">
                            <div class="contribution-item">
                                <i class="fas fa-route"></i>
                                <span>15 км велоалеи</span>
                            </div>
                        </div>
                        <div class="sponsor-badges">
                            <span class="badge standard">Стандартен партньор</span>
                        </div>
                    </div>

                    <div class="sponsor-card">
                        <div class="sponsor-logo">
                            <i class="fas fa-water" style="font-size: 2.5rem; color: #00bcd4;"></i>
                        </div>
                        <h3>AquaPure Systems</h3>
                        <p class="sponsor-type">Пречистване на вода</p>
                        <p class="sponsor-description">Системи за пречистване на вода и опазване на водните ресурси.</p>
                        <div class="sponsor-contribution">
                            <div class="contribution-item">
                                <i class="fas fa-tint"></i>
                                <span>1М литра пречистена вода</span>
                            </div>
                        </div>
                        <div class="sponsor-badges">
                            <span class="badge standard">Стандартен партньор</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sponsors-tier bronze-tier">
                <h2 class="tier-title">
                    <i class="fas fa-handshake"></i>
                    Корпоративни партньори
                </h2>
                <div class="sponsors-grid corporate-grid">
                    <div class="sponsor-card compact">
                        <div class="sponsor-logo">
                            <i class="fas fa-building" style="font-size: 2rem; color: #795548;"></i>
                        </div>
                        <h4>София Мол</h4>
                        <p class="sponsor-type">Търговски център</p>
                        <div class="sponsor-badges">
                            <span class="badge bronze">Бронзов партньор</span>
                        </div>
                    </div>

                    <div class="sponsor-card compact">
                        <div class="sponsor-logo">
                            <i class="fas fa-utensils" style="font-size: 2rem; color: #ff5722;"></i>
                        </div>
                        <h4>EcoFood Bulgaria</h4>
                        <p class="sponsor-type">Био храни</p>
                        <div class="sponsor-badges">
                            <span class="badge bronze">Бронзов партньор</span>
                        </div>
                    </div>

                    <div class="sponsor-card compact">
                        <div class="sponsor-logo">
                            <i class="fas fa-car" style="font-size: 2rem; color: #9c27b0;"></i>
                        </div>
                        <h4>ElectricDrive BG</h4>
                        <p class="sponsor-type">Електромобили</p>
                        <div class="sponsor-badges">
                            <span class="badge bronze">Бронзов партньор</span>
                        </div>
                    </div>

                    <div class="sponsor-card compact">
                        <div class="sponsor-logo">
                            <i class="fas fa-home" style="font-size: 2rem; color: #607d8b;"></i>
                        </div>
                        <h4>GreenHomes Ltd</h4>
                        <p class="sponsor-type">Еко строителство</p>
                        <div class="sponsor-badges">
                            <span class="badge bronze">Бронзов партньор</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="partnership-benefits">
                <h2>Станете наш партньор</h2>
                <p class="benefits-intro">Присъединете се към нашата мисия за по-зелена София</p>
                
                <div class="benefits-grid">
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <h3 data-translate="visibility_benefit">Видимост</h3>
                        <p>Вашият бранд ще бъде видян от хиляди екологично съзнателни граждани</p>
                    </div>

                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 data-translate="social_responsibility">Социална отговорност</h3>
                        <p>Покажете своята ангажираност към устойчивото развитие на града</p>
                    </div>

                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 data-translate="community_benefit">Общност</h3>
                        <p>Станете част от активна общност, която се грижи за околната среда</p>
                    </div>

                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 data-translate="growth_benefit">Растеж</h3>
                        <p>Достигнете до нови клиенти, които ценят екологичните инициативи</p>
                    </div>
                </div>

                <div class="cta-section">
                    <h3 data-translate="ready_to_make_difference">Готови ли сте да направите разликата?</h3>
                    <div class="cta-buttons">
                        <button class="btn-primary become-sponsor" onclick="showBecomeSponsorModal()">
                            <i class="fas fa-handshake"></i>
                            Станете спонсор
                        </button>
                        <button class="btn-secondary contact-us" onclick="showContactModal()">
                            <i class="fas fa-envelope"></i>
                            Свържете се с нас
                        </button>
                    </div>
                </div>
            </div>

            <div class="impact-stats">
                <h2 data-translate="partnership_impact">Въздействие на партньорствата</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" data-target="2500">0</div>
                        <div class="stat-label" data-translate="trees_planted">Засадени дървета</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" data-target="150000">0</div>
                        <div class="stat-label" data-translate="investment_amount">Лева инвестиции</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" data-target="35">0</div>
                        <div class="stat-label" data-translate="cleaner_air">% по-чист въздух</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" data-target="12">0</div>
                        <div class="stat-label" data-translate="new_parks">Нови паркове</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="addLocationModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addLocationModal')">&times;</span>
            <h3>Добави нова локация</h3>
            <form id="locationForm">
                <input type="text" placeholder="Име на локацията" required>
                <textarea placeholder="Описание" required></textarea>
                <select required>
                    <option value="">Избери тип</option>
                    <option value="park">Парк</option>
                    <option value="trail">Еко пътека</option>
                    <option value="bike">Велоалея</option>
                    <option value="plant">Място за засаждане</option>
                </select>
                <div class="form-group">
                    <label>Кликни на картата за избор на локация:</label>
                    <div id="mini-map" class="mini-map">
                        <p>Мини карта за избор на координати</p>
                    </div>
                </div>
                <button type="submit" class="btn-primary">Добави локация</button>
            </form>
        </div>
    </div>

    <div id="addActionModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addActionModal')">&times;</span>
            <h3>Добави еко действие</h3>
            <form id="actionForm">
                <input type="text" name="title" placeholder="Заглавие на действието" required>
                <textarea name="description" placeholder="Опиши какво си направил..." required></textarea>
                <input type="file" name="image" accept="image/*">
                <select name="type" required>
                    <option value="">Тип действие</option>
                    <option value="tree">Засаждане на дърво</option>
                    <option value="clean">Почистване</option>
                    <option value="bike">Каране на колело</option>
                    <option value="recycle">Рециклиране</option>
                </select>
                <input type="text" name="location" placeholder="Локация" required>
                <button type="submit" class="btn-primary">Сподели действието</button>
            </form>
        </div>
    </div>

    <button id="chat-button">🌱</button>

    <div id="chat-modal">
        <div id="chat-header">Еко Асистент</div>
        <div id="chat-body">
            
        </div>
        <div id="chat-footer">
            <input type="text" id="chat-input" placeholder="Попитай за еко инициативи...">
            <button id="chat-send">Изпрати</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatButton = document.getElementById('chat-button');
            const chatModal = document.getElementById('chat-modal');
            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');
            const chatBody = document.getElementById('chat-body');

            chatButton.addEventListener('click', (e) => {
                e.stopPropagation(); 
                chatModal.style.display = chatModal.style.display === 'none' ? 'flex' : 'none';
            });

            document.addEventListener('click', (e) => {
                
                if (chatModal.style.display === 'flex') {
                    
                    if (!chatModal.contains(e.target) && !chatButton.contains(e.target)) {
                        chatModal.style.display = 'none';
                    }
                }
            });

            chatModal.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            let isResizing = false;
            let initialWidth, initialHeight, initialX, initialY;

            chatModal.addEventListener('mousedown', function(e) {
                const rect = chatModal.getBoundingClientRect();
                const isInResizeArea = (
                    e.clientX <= rect.left + 10 &&
                    e.clientY <= rect.top + 10
                );

                if (isInResizeArea) {
                    isResizing = true;
                    initialWidth = chatModal.offsetWidth;
                    initialHeight = chatModal.offsetHeight;
                    initialX = e.clientX;
                    initialY = e.clientY;
                }
            });

            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;

                const width = initialWidth - (e.clientX - initialX);
                const height = initialHeight - (e.clientY - initialY);

                const newWidth = Math.min(Math.max(width, 350), 800);
                const newHeight = Math.min(Math.max(height, 400), 800);

                chatModal.style.width = newWidth + 'px';
                chatModal.style.height = newHeight + 'px';
            });

            document.addEventListener('mouseup', function() {
                isResizing = false;
            });

            chatSend.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                addMessage('user-message', message);
                chatInput.value = '';

                fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.reply) {
                        addMessage('ai-message', data.reply);
                    } else {
                        addMessage('ai-message', 'Грешка: ' + data.error);
                    }
                })
                .catch(error => {
                    addMessage('ai-message', 'Грешка: ' + error.message);
                });
            }

            function addMessage(className, text) {
                const div = document.createElement('div');
                div.classList.add('message', className);
                div.textContent = text;
                chatBody.appendChild(div);
                chatBody.scrollTop = chatBody.scrollHeight; 
            }
        });
    </script>

    <script src="script.js"></script>
    <script src="static/js/auth.js"></script>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h3>Вход</h3>
            <form id="loginForm" onsubmit="loginUser(event)">
                <div class="form-group">
                    <label for="login-email">Имейл</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Парола</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn-primary">Вход</button>
                <p class="form-footer">
                    Нямате профил? 
                    <a href="#" onclick="switchModal('loginModal', 'registerModal')">Регистрирайте се</a>
                </p>
            </form>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h3>Регистрация</h3>
            <form id="registerForm" onsubmit="registerUser(event)" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="register-username">Потребителско име</label>
                    <input type="text" id="register-username" name="username" required minlength="3">
                </div>
                <div class="form-group">
                    <label for="register-email">Имейл</label>
                    <input type="email" id="register-email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Парола</label>
                    <input type="password" id="register-password" name="password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Повтори парола</label>
                    <input type="password" id="register-confirm-password" name="confirm_password" required>
                </div>
                <div class="form-group">
                    <label for="register-profile-picture">Снимка за профил (по избор)</label>
                    <input type="file" id="register-profile-picture" name="profile_picture" accept="image/*">
                    <div class="file-upload-info">
                        <small>Поддържани формати: PNG, JPG, JPEG, GIF, WebP. Максимален размер: 5MB</small>
                    </div>
                </div>
                <button type="submit" class="btn-primary">Регистрация</button>
                <p class="form-footer">
                    Вече имате профил? 
                    <a href="#" onclick="switchModal('registerModal', 'loginModal')">Влезте</a>
                </p>
            </form>
        </div>
    </div>
</body>
</html>